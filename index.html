<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Futuristic Checkout</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
<style>
body {
    margin: 0;
    font-family: 'Orbitron', sans-serif;
    background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    color: #fff;
    overflow: hidden;
}
.checkout-container, .login-container {
    background: rgba(0,0,0,0.85);
    padding: 40px 60px;
    border-radius: 20px;
    box-shadow: 0 0 50px rgba(0,255,255,0.5);
    text-align: center;
    min-width: 350px;
}
h1 { font-size: 2em; margin-bottom: 20px; color: #00fff7; text-shadow: 0 0 10px #00fff7, 0 0 20px #00fff7; }
input { width: 80%; padding: 12px; margin: 8px 0; border-radius: 10px; border: none; outline: none; font-size: 1em; }
button { margin-top: 20px; padding: 15px 40px; font-size: 1.2em; border-radius: 12px; cursor: pointer; font-weight: bold; color: #000; }
#payBtn { background: linear-gradient(45deg, #00fff7, #ff4d6d); box-shadow: 0 0 20px #00fff7; transition: 0.3s; }
#payBtn:hover { box-shadow: 0 0 40px #ff4d6d; transform: scale(1.05); }
#loginBtn { background: linear-gradient(45deg, #ff4d6d, #00fff7); box-shadow: 0 0 20px #ff4d6d; transition: 0.3s; }
#loginBtn:hover { box-shadow: 0 0 40px #00fff7; transform: scale(1.05); }
#mfaOverlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); display:flex; justify-content:center; align-items:center; z-index:9999; backdrop-filter: blur(5px); }
.mfa-popup { background:#111; border-radius:20px; padding:40px 30px; text-align:center; box-shadow:0 0 50px #00fff7; animation: pop 0.4s ease-out; }
@keyframes pop { 0% {transform:scale(0.5);opacity:0;} 100% {transform:scale(1);opacity:1;} }
.mfa-popup h2 { color:#00fff7; text-shadow:0 0 15px #00fff7; margin-bottom:15px; }
.mfa-popup p { margin-bottom:25px; color:#fff; text-shadow:0 0 5px #fff; }
#otpInput { width:80%; padding:12px; border-radius:10px; border:none; font-size:1em; margin-bottom:20px; outline:none; box-shadow:0 0 15px rgba(0,255,255,0.5); background:#222; color:#fff; }
#verifyMfaBtn { padding:12px 30px; font-size:1.1em; border:none; border-radius:12px; background:linear-gradient(45deg,#ff4d6d,#00fff7); cursor:pointer; font-weight:bold; color:#000; box-shadow:0 0 20px #ff4d6d; transition:0.3s; }
#verifyMfaBtn:hover { box-shadow:0 0 40px #00fff7; transform:scale(1.05); }
</style>
</head>
<body>

<div class="checkout-container" style="display:none;">
  <h1>ðŸš€ Checkout</h1>
  <form id="checkout-form">
    <input type="email" id="checkout_email" name="email" placeholder="Email" readonly />
    <input type="text" id="recipient" placeholder="Recipient Name" />
    <input type="text" id="account" placeholder="Account Number" />
    <input type="text" id="concept" placeholder="Payment Concept" />
    <input type="number" id="amountInput" name="amount" placeholder="Amount" min="0" />x
    <input type="text" id="currencyInput" name="currency" placeholder="Currency (e.g., USD)" value="USD" />
    <button id="payBtn" type="submit">Pay</button>
  </form>
</div>

<div class="login-container">
    <h1>Login</h1>
    <input type="text" id="username" placeholder="Username" />
    <input type="password" id="password" placeholder="Password" />
    <button id="loginBtn">Login</button>
</div>
<script src="mfaSystem.js"
        data-api-base-url="http://127.0.0.1:5050"
        data-merchant-id="merchant_1"
        data-form-selector="#checkout-form"></script>

<script>
  const API_BASE = 'http://127.0.0.1:5050';
  let currentUser = null;

  document.getElementById('loginBtn')?.addEventListener('click', async () => {
    const username = (document.getElementById('username').value || '').trim();
    const password = (document.getElementById('password').value || '').trim();
    if (!username || !password) { alert('Please enter username and password.'); return; }
    try {
      const res = await fetch(`${API_BASE}/api/login`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ username, password })
      });
      const data = await res.json().catch(() => ({}));
      if (!res.ok || !data.success) {
        alert(data.error || 'Login failed.');
        return;
      }
      currentUser = data.username || username;
      document.querySelector('.login-container').style.display = 'none';
      document.querySelector('.checkout-container').style.display = 'block';
      const checkoutEmail = document.getElementById('checkout_email');
      if (checkoutEmail) checkoutEmail.value = `${currentUser}@demo.com`;
    } catch (e) {
      console.error(e);
      alert('Login error. Please try again.');
    }
  });
</script>
</body>
</html>
